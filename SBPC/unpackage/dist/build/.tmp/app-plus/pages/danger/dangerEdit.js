(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/danger/dangerEdit"],{"0ae5":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},i=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return i})},3005:function(t,e,o){},4876:function(t,e,o){"use strict";o.r(e);var n=o("0ae5"),i=o("c848");for(var a in i)"default"!==a&&function(t){o.d(e,t,function(){return i[t]})}(a);o("cfba");var s=o("2877"),l=Object(s["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=l.exports},b35d:function(t,e,o){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=u(o("9fbc")),a=u(o("40bc")),s=u(o("736d")),l=(u(o("fa28")),u(o("bc96"))),d=o("2f62");function u(t){return t&&t.__esModule?t:{default:t}}var c=function(){return o.e("components/list/uni-list/uni-list").then(o.bind(null,"8959"))},r=function(){return o.e("components/list/uni-icon/uni-icon").then(o.bind(null,"09d6"))},h=function(){return o.e("components/list/uni-list-item/uni-list-item").then(o.bind(null,"d36e"))},f={computed:(0,d.mapState)(["userInfo"]),components:{uniList:c,uniListItem:h,uniIcon:r},data:function(){return{model:{instanceid:"",recordid:"",yhms:"",yhdj:"",yhhg:"",yhlx:"",zgqx:"",yhly:"",zrbm:null},littleImageWidth:0,createImgList:[],changeImgList:[],confirmImgList:[],pageState:1,dangerLevel:a.default.dangerLevel,dangerResult:a.default.dangerResult,dangerType:a.default.dangerType,dangerSource:a.default.dangerSource,changeOpinion:a.default.changeOpinion,dangerReason:a.default.dangerReason,viewTop:null}},onLoad:function(e){this.littleImageWidth=(t.getSystemInfoSync().windowWidth-50)/4,this.model.instanceid=null==e.instanceid?"":e.instanceid,this.model.recordid=null==e.recordid?"":e.recordid,""!=this.model.instanceid||""!=this.model.recordid?this.getDangerDetail():(this.model.fqrid=this.userInfo.userid,this.model.fqrmc=this.userInfo.username)},onNavigationBarButtonTap:function(){null!=this.model.logList?t.navigateTo({url:"dangerLog?logList="+JSON.stringify(this.model.logList)}):t.showToast({icon:"none",title:"暂无日志"})},onUnload:function(){var t=getCurrentPages(),e=t[t.length-2],o=e.$getAppWebview();plus.webview.postMessageToUniNView({refreshCode:"REFRESH"},o.id)},methods:{saveClick:function(e){var o=this;1==o.checkInput()&&(o.model.userid=o.userInfo.userid,o.model.zrbmid=null==o.model.zrbm?"":o.model.zrbm.id,o.model.zrbmmc=null==o.model.zrbm?"":o.model.zrbm.name,s.default.requestLoading(i.default.addDanger,o.model,"保存隐患",function(e){o.model=e,t.showToast({icon:"none",title:"保存成功"}),o.uploadPhoto(!1,function(){})},function(){t.showToast({icon:"none",title:"保存失败"})},function(){}))},checkInput:function(e){return 1==this.pageState?""==this.model.yhms?(t.showToast({icon:"none",title:"请填写隐患描述"}),!1):""==this.model.yhdj?(t.showToast({icon:"none",title:"请填写隐患等级"}),!1):""==this.model.yhhg?(t.showToast({icon:"none",title:"请填写隐患后果"}),!1):""==this.model.yhlx?(t.showToast({icon:"none",title:"请填写隐患类型"}),!1):""==this.model.zgqx?(t.showToast({icon:"none",title:"请填写整改期限"}),!1):""==this.model.yhly?(t.showToast({icon:"none",title:"请填写隐患来源"}),!1):""==this.model.zrbm?(t.showToast({icon:"none",title:"请填写责任部门"}),!1):""!=this.model.fqrmc||(t.showToast({icon:"none",title:"请填写发起人"}),!1):2==this.pageState?""==this.model.rwhg?(t.showToast({icon:"none",title:"请填写隐患因素"}),!1):""==this.model.yyfx?(t.showToast({icon:"none",title:"请填写原因分析"}),!1):""==this.model.yhzgqk?(t.showToast({icon:"none",title:"请填写整改情况"}),!1):""==this.model.zgwcrq?(t.showToast({icon:"none",title:"请填写完成日期"}),!1):""!=this.model.zgrmc||(t.showToast({icon:"none",title:"请填写整改人"}),!1):3!=this.pageState||(""==this.model.yzqk?(t.showToast({icon:"none",title:"请填写完成情况"}),!1):""==this.model.yzrmc?(t.showToast({icon:"none",title:"请填写确认人"}),!1):""!=this.model.yzrtxrq||(t.showToast({icon:"none",title:"请填写填报日期"}),!1))},roamClick:function(e){var o=this;o.model.userid=o.userInfo.userid,o.model.operationname=e.operationname,o.model.nextstatusname=e.nextstatusname,o.model.prestatusname=e.prestatusname,o.model.flowtype=e.flowtype,s.default.requestLoading(i.default.flowDanger,o.model,"正在流转",function(n){if(null!=n.data||"200"!=n.repCode){var i=n.data,a="DANGER_TRANSFER";t.navigateTo({url:"../common/personChoose?key="+a+"&condition="+i+"&mltiple=false"}),o.$fire.once(a,function(t){o.flowDanger(t,e)})}else o.uploadPhoto(!0,function(){t.showToast({icon:"none",title:n.repMsg}),setTimeout(function(){t.navigateBack({delta:1})},1e3)})},function(){t.showToast({icon:"none",title:"流转失败"})},function(){})},flowDanger:function(e,o){var n=this;n.model.receiverid=e.id,s.default.requestLoading(i.default.flowDangerAfterChooseTarget,n.model,"正在流转",function(e){n.uploadPhoto(!0,function(){t.showToast({icon:"none",title:e.repMsg}),setTimeout(function(){t.navigateBack({delta:1})},1e3)})},function(){t.showToast({icon:"none",title:"流转失败"})},function(){})},getDangerDetail:function(){var e=this;s.default.requestLoading(i.default.getDangerDetail,e.model,"正在加载",function(t){e.model=t;var o={name:t.zrbmmc,id:t.zrbmid};e.model.zrbm=o,e.classifyPhotos(e.model.zplist),null!=e.model.controlcode?-1!=e.model.controlcode.indexOf("start")?e.pageState=1:-1!=e.model.controlcode.indexOf("zzzg")?(e.pageState=2,e.model.zgrmc=e.userInfo.username,e.model.zgrid=e.userInfo.userid):-1!=e.model.controlcode.indexOf("yzfj")&&(e.pageState=3,e.model.yzrmc=e.userInfo.username,e.model.yzrid=e.userInfo.userid):e.pageState=0},function(){t.showToast({icon:"none",title:"加载失败"})},function(){})},classifyPhotos:function(t){if(null!=t)for(var e=0;e<t.length;e++){var o=t[e],n={fileid:o.attid,src:i.default.host+i.default.loadImage+"&attid="+o.attid,type:2,yhid:o.zpsgrecordid,attachtype:o.attachtype};"fxwt"==n.attachtype?this.createImgList.push(n):"zzwt"==n.attachtype?this.changeImgList.push(n):"yzwt"==n.attachtype&&this.confirmImgList.push(n)}},jumpInput:function(e,o,n,i){var a=this;this.pageState==i&&(t.navigateTo({url:"../common/inputPage?key="+e+"&placeholder="+o+"&text="+n}),this.$fire.once(e,function(t){a.model[e]=t}))},jumpOrgChoose:function(e,o){var i=this;this.pageState==o&&(t.navigateTo({url:"../common/orgChoose?selected="+JSON.stringify([])+"&key="+e+"&mltiple=false"}),this.$fire.once(e,function(t){console.log(n(""+JSON.stringify(t)," at pages/danger/dangerEdit.vue:532")),i.model[e]=t}))},alertSheetShow:function(e,o,n){var i=this;i.pageState==n&&t.showActionSheet({itemList:o,success:function(t){i.model[e]=o[t.tapIndex]},fail:function(t){}})},pickerChange:function(t,e,o){this.pageState==o&&(this.model[e.target.id]=t[e.target.value])},dateChange:function(t,e,o){this.pageState==o&&(console.log(n("key:"+t+",value:"+e.target.value," at pages/danger/dangerEdit.vue:561")),this.model[t]=e.target.value)},opinionSheetShow:function(e,o){var n=this;t.showActionSheet({itemList:o,success:function(t){3!=t.tapIndex?n.model[e]=o[t.tapIndex]:n.jumpInput(e,"请输入审批意见",n.model[e],n.pageState)},fail:function(t){}})},addPhoto:function(t){var e=this;l.default.addPhoto(function(o){e[t]=e[t].concat(o)})},deleteImage:function(t,e,o){var n=this;l.default.deletePhoto(n[t],e,o,function(e){n[t]=e})},viewPhoto:function(t){l.default.viewPhoto(this[t])},uploadPhoto:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1?arguments[1]:void 0,o=this,n=o.getAttachtypeAndPhotoList().type,i=o.getAttachtypeAndPhotoList().photoList;l.default.uploadPhoto(o.userInfo.userid,o.model.recordid,n,i,function(n){n.length>0&&(t.showToast({icon:"none",title:"照片上传成功"}),o.createImgList=[],o.changeImgList=[],o.confirmImgList=[],o.classifyPhotos(n)),e()})},getAttachtypeAndPhotoList:function(){var t={};return 1==this.pageState?(t.type="fxwt",t.photoList=this.createImgList):2==this.pageState?(t.type="zzwt",t.photoList=this.changeImgList):3==this.pageState?(t.type="yzwt",t.photoList=this.confirmImgList):(t.type="",t.photoList=[]),t}}};e.default=f}).call(this,o("6e42")["default"],o("0de9")["default"])},b446:function(t,e,o){"use strict";(function(t){o("c6c1"),o("921b");n(o("66fd"));var e=n(o("4876"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("6e42")["createPage"])},c848:function(t,e,o){"use strict";o.r(e);var n=o("b35d"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=i.a},cfba:function(t,e,o){"use strict";var n=o("3005"),i=o.n(n);i.a}},[["b446","common/runtime","common/vendor"]]]);