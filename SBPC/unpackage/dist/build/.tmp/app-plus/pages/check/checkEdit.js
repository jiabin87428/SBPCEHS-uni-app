(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/check/checkEdit"],{"5d63":function(t,e,i){"use strict";i.r(e);var n=i("6702"),o=i.n(n);for(var l in n)"default"!==l&&function(t){i.d(e,t,function(){return n[t]})}(l);e["default"]=o.a},"634f":function(t,e,i){},6702:function(t,e,i){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=d(i("9fbc")),l=(d(i("40bc")),d(i("736d"))),s=(d(i("fa28")),d(i("bc96"))),c=i("2f62");function d(t){return t&&t.__esModule?t:{default:t}}var r=function(){return i.e("components/list/uni-list/uni-list").then(i.bind(null,"8959"))},u=function(){return i.e("components/list/uni-icon/uni-icon").then(i.bind(null,"09d6"))},a=function(){return i.e("components/list/uni-list-item/uni-list-item").then(i.bind(null,"d36e"))},f=function(){return i.e("components/prompt/prompt").then(i.bind(null,"d869"))},h={computed:(0,c.mapState)(["userInfo"]),components:{uniList:r,uniListItem:a,uniIcon:u,prompt:f},data:function(){return{model:{recordid:"",userid:"",jcdzt:"1",jclx:"",llrid:"",llrmc:"",jcrq:"",qtcyid:"",qtcy:"",mb:"",jcjlList:[]},currentModule:null,checkTypes:[],selectedPersons:[],selectedModule:[],editable:!0,promptVisible:!1,normal:{color:"#24BE41",size:"22",type:"checkbox-filled"},undetected:{color:"#FFDE52",size:"22",type:"info-filled"},abnormal:{color:"#C11E1E",size:"22",type:"clear"},zplists:[]}},onLoad:function(t){var e=null==t.recordid?"":t.recordid;""==e?(this.model.llrid=this.userInfo.userid,this.model.llrmc=this.userInfo.username):(this.model.recordid=e,this.getDetail()),this.getCheckTypes(),this.getCheckModule()},onNavigationBarButtonTap:function(){var e=this;t.showModal({content:"选择[一键正常]将要清除所有问题描述、检查方式、检查照片，是否确认？",success:function(t){t.confirm&&e.setAllOk()}})},onUnload:function(){},methods:{setAllOk:function(t){for(var e=0;e<this.model.jcjlList.length;e++)this.model.jcjlList[e].wtms="",this.model.jcjlList[e].zgqk="",this.model.jcjlList[e].zplist=[],this.model.jcjlList[e].ifwt="1"},getCheckTypes:function(e){var i=this,n={userid:i.userInfo.userid};l.default.requestLoading(o.default.getCheckTypes,n,"正在获取检查类型",function(t){i.checkTypes=t.data},function(){t.showToast({icon:"none",title:"获取失败"})},function(){})},getCheckModule:function(e){var i=this,n={userid:i.userInfo.userid};l.default.requestLoading(o.default.getCheckModule,n,"正在获取检查模板",function(t){i.selectedModule=t.data},function(){t.showToast({icon:"none",title:"获取失败"})},function(){})},getDetail:function(e){var i=this,n={userid:i.userInfo.userid,recordid:i.model.recordid};l.default.requestLoading(o.default.getCheckDetail,n,"正在获取检查详情",function(t){i.model=t,"5"==i.model.jcdzt&&(editable=!1);for(var e=[],n=0;n<t.jcjlList.length;n++)e=e.concat(t.jcjlList[n].zplist);i.classifyPhotos(e)},function(){t.showToast({icon:"none",title:"获取失败"})},function(){})},saveClick:function(t){this.doSave(1)},completeClick:function(t){this.doSave(5)},doSave:function(e){var i=this;i.zplists=[],i.model.userid=i.userInfo.userid,i.model.jcdzt=e;for(var n=i.model,s=0;s<i.model.jcjlList.length;s++){var c=i.model.jcjlList[s];i.zplists.push(c.zplist)}l.default.requestLoading(o.default.saveCheck,n,"正在保存检查",function(e){i.model=e;for(var n=0;n<i.model.jcjlList.length;n++){var o=i.model.jcjlList[n];o.zplist=i.zplists[n]}i.uploadPhoto(!1,function(){t.showToast({icon:"none",title:"保存成功"})})},function(){t.showToast({icon:"none",title:"保存失败"})},function(){})},uploadPhoto:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e=arguments.length>1?arguments[1]:void 0,i=this,o=0;o<i.model.jcjlList.length;o++){var l=i.model.jcjlList[o];console.log(n("item:"+JSON.stringify(l)," at pages/check/checkEdit.vue:289"));var c=l.jcjlrecordid,d=l.zplist;s.default.uploadPhoto(i.userInfo.userid,c,"",d,function(n){n.length>0&&(t.showToast({icon:"none",title:"照片上传成功"}),i.classifyPhotos(n)),e()})}},classifyPhotos:function(t){if(null!=t){for(var e=0;e<this.model.jcjlList.length;e++)this.model.jcjlList[e].zplist=[];for(e=0;e<t.length;e++)for(var i=t[e],n={fileid:i.attid,src:o.default.host+o.default.loadImage+"&attid="+i.attid,type:2,yhid:i.zpsgrecordid,attachtype:i.attachtype},l=0;l<this.model.jcjlList.length;l++){var s=this.model.jcjlList[l];s.jcjlrecordid==i.zpsgrecordid&&this.model.jcjlList[l].zplist.push(n)}}},typePickerChange:function(t,e){this.model[e.target.id]=t[e.target.value].dvalue,this.model["jclxbm"]=t[e.target.value].dvalue},dateChange:function(t,e){this.model[t]=e.target.value},jumpPersonChoose:function(e){var i=this,n="CHECK_PERSONS";t.navigateTo({url:"../common/personChoose?key="+n+"&mltiple=true&selected="+JSON.stringify(this.selectedPersons)}),i.$fire.once(n,function(t){i.selectedPersons=t,i.formatPersons()})},mbChange:function(t,e){this.currentModule=t[e.target.value],this.model[e.target.id]=t[e.target.value].mbmc,this.getCheckInfoByMb()},getCheckInfoByMb:function(){var e=this,i={userid:e.userInfo.userid,mbid:e.currentModule.mbid};l.default.requestLoading(o.default.getCheckInfo,i,"正在获取检查项",function(t){e.model.jcjlList=t.data},function(){t.showToast({icon:"none",title:"获取失败"})},function(){})},jumpEdit:function(e,i){var n=this;0!=n.editable&&t.setStorage({key:"LOCAL_ITEM",data:e,success:function(){var e="INFO_EDIT";t.navigateTo({url:"checkInfoEdit?index="+i+"&key="+e}),n.$fire.once(e,function(t){n.model.jcjlList.splice(t.index,1,t.item)})}})},addCheck:function(t){this.promptVisible=!0},clickPromptConfirm:function(e){if(""!=e){var i={bzlx:"",idx:"",ifwt:"",jcbz:e,jcbzid:"",jcjlrecordid:"",precordid:"",wtms:"",xmhfl:"",xmhflid:"",zgqk:"",zgtzdid:"",zgtzdmoduleid:"",zgzt:"",zplist:[]};this.model.jcjlList.push(i),this.promptVisible=!1}else t.showToast({icon:"none",title:"请输入检查标题内容"})},clickCancel:function(t){this.promptVisible=!1},formatPersons:function(){for(var t="",e="",i=0;i<this.selectedPersons.length;i++){var n=this.selectedPersons[i];t=n.id+";"+t,e=n.name+";"+e}this.model.qtcy=e,this.model.qtcyid=t},getIcon:function(t){return"1"==t.ifwt?this.normal:"3"==t.ifwt?this.abnormal:this.undetected}}};e.default=h}).call(this,i("6e42")["default"],i("0de9")["default"])},ad76:function(t,e,i){"use strict";(function(t){i("c6c1"),i("921b");n(i("66fd"));var e=n(i("cd38"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},b6e5:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.__map(t.model.jcjlList,function(e,i){var n=t.getIcon(e);return{$orig:t.__get_orig(e),m0:n}}));t.$mp.data=Object.assign({},{$root:{l0:i}})},o=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},cd38:function(t,e,i){"use strict";i.r(e);var n=i("b6e5"),o=i("5d63");for(var l in o)"default"!==l&&function(t){i.d(e,t,function(){return o[t]})}(l);i("d490");var s=i("2877"),c=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=c.exports},d490:function(t,e,i){"use strict";var n=i("634f"),o=i.n(n);o.a}},[["ad76","common/runtime","common/vendor"]]]);